---
title: MCP servers
---

Agent Layer projects MCP server configuration into each supported client's native format so tools are available everywhere your agents run.

## Where servers are defined

Servers live in `.agent-layer/config.toml` under `[mcp]`:

```toml
[[mcp.servers]]
id = "example-api"
enabled = true
transport = "http"
url = "https://example.com/mcp"
headers = { Authorization = "Bearer ${AL_EXAMPLE_TOKEN}" }
```

Each server requires:

- `id` (unique, non-empty)
- `enabled` (true or false)
- `transport` (`http` or `stdio`)

## HTTP servers

HTTP servers use `url` and optional `headers`. You can also set `http_transport`:

- `sse` (default)
- `streamable`

If `transport = "http"`, do not set `command`, `args`, or `env`.

## Stdio servers

Stdio servers run a local command:

```toml
[[mcp.servers]]
id = "filesystem"
enabled = true
transport = "stdio"
command = "npx"
args = ["-y", "@modelcontextprotocol/server-filesystem", "${AL_REPO_ROOT}"]
```

If `transport = "stdio"`, do not set `url` or `headers`.

## Secrets and environment variables

Secrets live in `.agent-layer/.env` and should be referenced using `AL_`-prefixed placeholders:

```env
AL_EXAMPLE_TOKEN=your-token-here
```

Only variables prefixed with `AL_` are loaded from `.env`.

## Client targeting

Use `clients = ["gemini", "claude", "codex", "vscode", "antigravity"]` to restrict a server to specific clients. If you omit `clients`, the server is projected to all supported clients.

## Built-in path placeholder

`${AL_REPO_ROOT}` expands to the absolute repo root during sync and doctor checks. Use it when a server needs filesystem access scoped to the current repo.

## Doctor checks

`al doctor` connects to each enabled MCP server, lists available tools, and warns about common issues. It waits up to 30 seconds per server before timing out.

## Internal MCP prompt server

Agent Layer includes an internal MCP prompt server for slash commands. It is always generated and wired into client configs and does not appear in `config.toml`.

## Common pitfalls

- `npx` or `uvx` not installed when using stdio servers
- missing `AL_` secrets in `.agent-layer/.env`
- mixing `url` with `command` in the same server block
- enabling too many servers and overloading context

:::tip
Start with one or two servers, verify with `al doctor`, then expand. It is easier to trust your agents when the tool surface is deliberate and scoped.
:::
